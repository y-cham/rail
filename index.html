<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>근무 스케줄 캘린더</title>
  <!-- Tailwind CSS CDN을 로드합니다. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Inter 폰트를 사용합니다. */
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="font-sans m-0 p-0 bg-gray-100 text-gray-800">
  <div class="container max-w-4xl mx-auto my-5 p-5 bg-white rounded-lg shadow-lg">
    <h1 class="text-center text-3xl font-extrabold mb-6 text-gray-900">철도 근무 스케줄 캘린더</h1>

    <!-- 오늘 날짜를 표시하는 영역 -->
    <div id="today-date" class="text-center text-lg font-semibold mb-4 text-blue-600"></div>

    <!-- 근무 패턴 선택 라디오 버튼 -->
    <div class="pattern-select flex justify-center gap-6 mt-4 mb-6 p-3 bg-blue-50 rounded-lg shadow-inner">
      <label class="flex items-center space-x-2 text-lg text-gray-700">
        <input type="radio" name="pattern" value="A" checked class="form-radio h-5 w-5 text-blue-600">
        <span>A</span>
      </label>
      <label class="flex items-center space-x-2 text-lg text-gray-700">
        <input type="radio" name="pattern" value="B" class="form-radio h-5 w-5 text-blue-600">
        <span>B</span>
      </label>
      <label class="flex items-center space-x-2 text-lg text-gray-700">
        <input type="radio" name="pattern" value="C" class="form-radio h-5 w-5 text-blue-600">
        <span>C</span>
      </label>
      <label class="flex items-center space-x-2 text-lg text-gray-700">
        <input type="radio" name="pattern" value="D" class="form-radio h-5 w-5 text-blue-600">
        <span>D</span>
      </label>
    </div>

    <!-- 요일 라벨 -->
    <div class="day-labels grid grid-cols-7 font-bold text-center mt-5 text-gray-700 text-base py-2 border-b border-gray-300">
      <div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div><div>일</div>
    </div>
    <!-- 캘린더 날짜가 표시될 영역 -->
    <div id="calendar" class="grid grid-cols-7 gap-1 mt-2"></div>
  </div>

  <script>
    const calendarEl = document.getElementById('calendar');
    const todayDateEl = document.getElementById('today-date');

    // 각 근무 패턴 정의
    const shiftPatterns = {
      'A': ['주간', '야간', '비번', '휴무'],
      'B': ['야간', '비번', '휴무', '주간'],
      'C': ['비번', '휴무', '주간', '야간'],
      'D': ['휴무', '주간', '야간', '비번']
    };

    // 각 패턴에서 '휴무'가 위치하는 인덱스 (오늘을 '휴무'로 맞추기 위함)
    const targetShiftIndexForToday = {
      'A': 3, // ['주간', '야간', '비번', '휴무'] 에서 '휴무'는 인덱스 3
      'B': 2, // ['야간', '비번', '휴무', '주간'] 에서 '휴무'는 인덱스 2
      'C': 1, // ['비번', '휴무', '주간', '야간'] 에서 '휴무'는 인덱스 1
      'D': 0  // ['휴무', '주간', '야간', '비번'] 에서 '휴무'는 인덱스 0
    };

    // 현재 선택된 패턴 키 (A, B, C, D)를 가져오는 함수
    function getSelectedPatternKey() {
      return document.querySelector('input[name="pattern"]:checked').value;
    }

    // 캘린더를 렌더링하는 함수
    function renderCalendar() {
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth(); // 0부터 시작 (0:1월, 1:2월...)
      const currentDayOfMonth = today.getDate(); // 오늘 날짜 (1-31)

      // 오늘 날짜를 상단에 표시
      todayDateEl.textContent = `${year}년 ${month + 1}월 ${currentDayOfMonth}일`;

      const firstDayOfMonth = new Date(year, month, 1); // 현재 월의 첫째 날
      const lastDayOfMonth = new Date(year, month + 1, 0); // 현재 월의 마지막 날
      const daysInMonth = lastDayOfMonth.getDate(); // 현재 월의 총 일수
      calendarEl.innerHTML = ''; // 캘린더 초기화

      const selectedPatternKey = getSelectedPatternKey();
      const currentShiftPattern = shiftPatterns[selectedPatternKey];
      const patternLength = currentShiftPattern.length; // 패턴 길이 (항상 4)

      // 현재 월의 첫째 날의 근무 형태 인덱스를 계산합니다.
      // 이는 오늘 날짜가 선택된 패턴에서 '휴무'에 해당하도록 조정합니다.
      const targetIndex = targetShiftIndexForToday[selectedPatternKey];
      const daysOffsetFromFirstToToday = currentDayOfMonth - 1; // 월의 첫째 날부터 오늘까지의 일수 차이
      let currentShiftIndex = (targetIndex - (daysOffsetFromFirstToToday % patternLength) + patternLength) % patternLength;

      // 월요일부터 시작하도록 달력의 빈 공간을 채웁니다.
      // getDay()는 일요일(0)부터 토요일(6)까지 반환합니다.
      // 월요일을 0으로 맞추기 위해 (getDay() + 6) % 7을 사용합니다.
      let emptyStartDays = (firstDayOfMonth.getDay() + 6) % 7;

      for (let i = 0; i < emptyStartDays; i++) {
        const blank = document.createElement('div');
        blank.className = 'day-placeholder bg-gray-50 rounded-md'; // 빈 날짜 칸에 배경색 추가
        calendarEl.appendChild(blank);
      }

      // 월의 각 날짜에 대한 캘린더 칸을 생성합니다.
      for (let i = 1; i <= daysInMonth; i++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'day bg-blue-50 p-2 rounded-md min-h-[80px] relative cursor-pointer hover:bg-blue-100 transition-colors duration-200';

        // 오늘 날짜를 강조합니다.
        if (i === currentDayOfMonth && month === today.getMonth() && year === today.getFullYear()) {
          dayEl.classList.add('border-2', 'border-blue-500', 'bg-blue-200', 'shadow-md');
        }

        const shift = currentShiftPattern[currentShiftIndex]; // 현재 날짜의 근무 형태
        currentShiftIndex = (currentShiftIndex + 1) % patternLength; // 다음 날짜를 위해 인덱스 증가 (패턴 반복)

        dayEl.innerHTML = `
          <span class="absolute top-1 right-2 text-sm text-gray-600 font-medium">${i}</span>
          <div class="shift mt-5 font-bold text-base text-center text-blue-800">${shift}</div>
        `;

        // 날짜 클릭 시 근무 형태를 수동으로 변경할 수 있는 이벤트 리스너
        dayEl.addEventListener('click', () => {
          const newShift = prompt('근무 형태를 입력하세요 (주간/야간/비번/휴무):', shift);
          if (['주간','야간','비번','휴무'].includes(newShift)) {
            dayEl.querySelector('.shift').textContent = newShift;
          } else if (newShift !== null) { // 사용자가 취소하지 않고 유효하지 않은 값을 입력한 경우
            alert('유효한 근무 형태를 입력해주세요: 주간, 야간, 비번, 휴무');
          }
        });

        calendarEl.appendChild(dayEl);
      }
    }

    // 페이지 로드 시 초기 캘린더 렌더링
    renderCalendar();

    // 근무 패턴 라디오 버튼 변경 시 캘린더 다시 렌더링
    document.querySelectorAll('input[name="pattern"]').forEach(radio => {
      radio.addEventListener('change', renderCalendar);
    });
  </script>
</body>
</html>
